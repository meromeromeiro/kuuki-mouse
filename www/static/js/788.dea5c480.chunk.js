"use strict";(self.webpackChunkmy_app=self.webpackChunkmy_app||[]).push([[788],{4788:(e,t,s)=>{s.r(t),s.d(t,{default:()=>i});var a=s(5043);async function r(e,t,s){const a=1048576;const r=Math.ceil(e.size/a);s(0);const l=Array.from({length:r},((r,l)=>async()=>await async function(r){const l=r*a,n=Math.min(l+a,e.size),o=e.slice(l,n);let i=null;for(let a=0;a<3;a++)try{const a=await fetch(t,{method:"PUT",headers:{"Content-Length":(l-n).toString(),"Content-Range":`bytes ${l}-${n-1}/${e.size}`},body:o});if(!a.ok)throw new Error(`Upload failed: ${a.statusText}`);const r=await a.json();return s((e=>e+1)),r}catch(c){i=c}if(i)throw i}(l))),n=await Promise.all(Array.from({length:1},(()=>async function(e){try{const t=[];for(;e.length>0;){const s=e.shift();if(!s)return t;const a=await s();t.push(a)}return t}catch(t){throw t}}(l))));return n.flat().find((e=>e.id))}var l=s(2370),n=s(5857),o=s(579);const i=()=>{const[e,t]=(0,a.useState)(null),[s,i]=(0,a.useState)(!1),[c,d]=(0,a.useState)({type:"",text:""}),[h,u]=(0,a.useState)([!1]),[x,m]=(0,a.useState)("");return(0,o.jsxs)(l.g,{children:[(0,o.jsx)(n.A,{}),(0,o.jsxs)("div",{className:"max-w-md mx-auto p-6 border border-gray-300 rounded-lg shadow-md bg-white",children:[(0,o.jsx)("h2",{className:"text-xl font-semibold mb-4 text-gray-800",children:"\u6587\u4ef6\u4e0a\u4f20"}),(0,o.jsxs)("div",{className:"mb-4",children:[(0,o.jsx)("input",{type:"file",onChange:e=>{const s=e.target.files[0];s&&(t(s),d({type:"",text:""}))},className:"block w-full text-sm text-gray-500  file:mr-4 file:py-2 file:px-4  file:rounded-md file:border-0  file:text-sm file:font-semibold  file:bg-blue-50 file:text-blue-700  hover:file:bg-blue-100 focus:outline-none",disabled:s}),e&&(0,o.jsxs)("div",{className:"mt-2 text-sm text-gray-600",children:["\u5df2\u9009\u62e9: ",e.name," (",(e.size/1024/1024).toFixed(2)," MB)"]})]}),s&&(0,o.jsxs)("div",{className:"mb-4",children:[(0,o.jsx)("div",{className:"h-2 w-full bg-gray-200 rounded-full overflow-hidden",children:(0,o.jsx)("div",{className:"h-full bg-blue-600 transition-all duration-300",style:{width:h/(e.size/1024/1024)*100+"%"}})}),(0,o.jsxs)("div",{className:"mt-1 text-sm text-gray-600 text-right",children:[(h/(e.size/1024/1024)*100).toFixed(2),"%"]})]}),(0,o.jsx)("button",{onClick:async()=>{if(e){i(!0),d({type:"",text:""}),u(0);try{const t=await fetch("https://upload.moonchan.xyz/api/upload",{method:"POST",headers:{"Content-Type":e.type}});if(!t.ok)throw new Error("\u83b7\u53d6\u4e0a\u4f20 URL \u5931\u8d25");const s=await t.json(),a=await r(e,s.uploadUrl,u);d({type:"success",text:"\u6587\u4ef6\u4e0a\u4f20\u6210\u529f\uff01"}),m(`https://upload.moonchan.xyz/api/${a.id}/${e.name}`)}catch(t){console.error("\u4e0a\u4f20\u5931\u8d25:",t),d({type:"error",text:"\u6587\u4ef6\u4e0a\u4f20\u5931\u8d25\uff0c\u8bf7\u91cd\u8bd5"})}finally{i(!1)}}else d({type:"error",text:"\u8bf7\u5148\u9009\u62e9\u4e00\u4e2a\u6587\u4ef6"})},disabled:s||!e,className:`w-full py-2 px-4 rounded-md \n                   ${s||!e?"bg-gray-400 cursor-not-allowed":"bg-blue-600 hover:bg-blue-700"}\n                   text-white font-semibold transition-colors`,children:s?"\u4e0a\u4f20\u4e2d...":"\u4e0a\u4f20\u6587\u4ef6"}),c.text&&(0,o.jsx)("div",{className:"mt-3 p-3 rounded-md text-sm\n                        "+("error"===c.type?"bg-red-100 text-red-700":"success"===c.type?"bg-green-100 text-green-700":""),children:c.text}),x&&(0,o.jsx)("div",{className:"mt-4",children:(0,o.jsx)("a",{href:x,target:"_blank",rel:"noopener noreferrer",className:"text-blue-600 hover:text-blue-800 break-all text-sm",children:x})})]})]})}}}]);
//# sourceMappingURL=788.dea5c480.chunk.js.map