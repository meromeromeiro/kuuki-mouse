"use strict";(self.webpackChunkmy_app=self.webpackChunkmy_app||[]).push([[58],{7114:(e,t,o)=>{o.d(t,{A:()=>l});var n=o(5043);function l(e,t){const[o,l]=(0,n.useState)((()=>{if("undefined"===typeof window)return t;try{const o=window.localStorage.getItem(e);return o?JSON.parse(o):t}catch(s){return console.error(`Error reading localStorage key \u201c${e}\u201d:`,s),t}})),[s,a]=(0,n.useState)(null),r=(0,n.useCallback)((t=>{try{const n=t instanceof Function?t(o):t;if(l(n),"undefined"!==typeof window){const t=JSON.stringify(n);window.localStorage.setItem(e,t),window.dispatchEvent(new StorageEvent("storage",{key:e,newValue:t}))}}catch(n){const t=n;console.error(`Error setting localStorage key \u201c${e}\u201d:`,t),a(t)}}),[e,o]);return(0,n.useEffect)((()=>{if("undefined"===typeof window)return;const t=t=>{if(console.log(t,t.key===e,t.newValue),t.key===e&&t.newValue)try{l(JSON.parse(t.newValue)),a(null)}catch(o){const t=o;console.error(`Error parsing new value for key \u201c${e}\u201d from storage event:`,t),a(t)}};return window.addEventListener("storage",t),()=>{window.removeEventListener("storage",t)}}),[e]),[o,r,s]}},9058:(e,t,o)=>{o.r(t),o.d(t,{default:()=>d});var n=o(5043),l=o(7114);async function s(e,t,o){const n=new FormData;n.append("file",e);const l=await fetch("https://proxy.moonchan.xyz/api/v2/media",{method:"POST",headers:{"X-Scheme":"https","X-Host":t,"X-Referer":`https://${t}/`,Authorization:`Bearer ${o}`},body:n,credentials:"include"}),s=await l.json();return console.log(s),s}function a(e){const t=document.createElement("textarea");t.value=e,t.style.position="fixed",t.style.top="-1000px",document.body.appendChild(t),t.select();try{document.execCommand("copy"),console.log("\u590d\u5236\u6210\u529f\uff01")}catch(o){console.error("\u590d\u5236\u5931\u8d25\uff1a",o)}finally{document.body.removeChild(t)}}var r=o(579);function i(e){let{onSucceed:t}=e;const[o]=(0,l.A)("mastodon",{host:"",access_token:""}),[a,i]=(0,n.useState)(null);return(0,r.jsxs)("form",{onSubmit:e=>{var n;e.preventDefault(),a&&(n=a,s(n,o.host,o.access_token)).then((e=>{t(e),i(null)})).catch((e=>{console.error("\u4e0a\u4f20\u5931\u8d25:",e)}))},className:"flex items-center space-x-2 w-full  max-w-md p-1 bg-white rounded-lg shadow-inner border border-gray-200  focus-within:ring-2 focus-within:ring-blue-500 transition-all",children:[(0,r.jsx)("input",{type:"file",onChange:e=>{e.target.files&&e.target.files.length>0&&i(e.target.files[0])},className:"block w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-lg file:border-0 file:text-sm file:font-medium file:bg-gray-100 file:text-gray-700 hover:file:bg-gray-200 cursor-pointer"}),(0,r.jsx)("button",{type:"submit",className:"px-4 py-2 bg-blue-600 text-white rounded-lg font-medium hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-opacity-50 disabled:opacity-50 disabled:cursor-not-allowed transition-colors whitespace-nowrap",disabled:null===a,children:"\u4e0a\u4f20"})]})}function c(e){let{data:t,onClick:o}=e;return(0,r.jsxs)("div",{className:"relative",onClick:()=>{o&&o(t)},children:[(0,r.jsx)("img",{src:t.preview_url,alt:`${t.id}`,className:"w-auto h-auto rounded-lg"}),(0,r.jsx)("button",{onClick:()=>{o&&o(t)},className:"absolute top-2 right-2 bg-red-600 text-white rounded-full p-1  hidden",children:"\u5220\u9664"})]})}const u=e=>{let{buttons:t,value:o,setValue:n}=e;return(0,r.jsx)("div",{className:"flex w-full rounded-lg overflow-hidden border border-gray-200 shadow-sm",role:"group",children:t.map((e=>(0,r.jsx)("button",{className:`flex-1 py-2 px-4 text-sm font-medium transition-colors duration-200\n                        ${o===e.value?"bg-blue-500 text-white":"bg-white text-gray-700 hover:bg-gray-50"}\n                        focus:outline-none focus:ring-2 focus:ring-blue-300\n                    `,onClick:()=>n(e.value),"aria-pressed":o===e.value,children:e.label},e.label)))})};function d(){const[e,t]=(0,l.A)("mastodon",{host:"",access_token:"",sensitive:!1,spoiler_text:"",visibility:"public"}),[o,a]=(0,l.A)("moonchan",{bid:23,tid:0}),[c,d]=(0,n.useState)(""),[g,h]=(0,n.useState)(null),[f,m]=(0,n.useState)([]),[x,b]=(0,n.useState)([]);(0,n.useEffect)((()=>{w(!0),b(f.map((e=>e.id)))}),[f]);const[y,w]=(0,n.useState)(!0),[v,k]=(0,n.useState)([]),j=e=>{console.log("\u4e0a\u4f20\u6210\u529f:",e),m((t=>[...t,e]))};async function N(t){if(0!==t.length){console.log(`\u5904\u7406 ${t.length} \u4e2a\u6587\u4ef6...`);for(const o of t){console.log("\u6587\u4ef6\u540d:",o.name),console.log("\u6587\u4ef6\u7c7b\u578b:",o.type),console.log("\u6587\u4ef6\u5927\u5c0f:",o.size,"bytes");const t=await s(o,e.host,e.access_token);j(t)}}}return(0,r.jsxs)("div",{className:"flex flex-col items-center justify-center min-h-screen bg-gray-100",onPaste:e=>{const t=e.clipboardData.items,o=[];for(let n=0;n<t.length;n++){const e=t[n];if("file"===e.kind){const t=e.getAsFile();t&&o.push(t)}}N(o)},onDragOver:e=>e.preventDefault(),onDrop:e=>{e.preventDefault();const t=e.dataTransfer.files;N(Array.from(t))},children:[(0,r.jsx)("input",{type:"text",className:"block w-full max-w-md text-sm text-gray-700 mr-4 py-2 px-4 rounded-lg border-0 text-sm font-medium",placeholder:"Host",value:e.host,onChange:o=>t({...e,host:o.target.value})}),(0,r.jsx)("input",{type:"text",className:"block w-full max-w-md text-sm text-gray-700 mr-4 py-2 px-4 rounded-lg border-0 text-sm font-medium",placeholder:"Access Token",value:e.access_token,onChange:o=>t({...e,access_token:o.target.value})}),(0,r.jsx)(i,{onSucceed:j}),(0,r.jsx)(p,{responseMedia:f,setImageArray:m}),(0,r.jsxs)("div",{className:"mt-4 w-full max-w-md space-y-4",children:[(0,r.jsx)(u,{buttons:[{label:"\u516c\u5f00",value:"public"},{label:"\u4e0d\u516c\u5f00",value:"unlisted"},{label:"\u79c1\u5bc6",value:"private"},{label:"\u79c1\u4fe1",value:"direct"}],value:e.visibility,setValue:o=>t({...e,visibility:o})}),(0,r.jsx)(u,{buttons:[{label:"true (blur)",value:!0},{label:"false",value:!1}],value:e.sensitive,setValue:o=>t({...e,sensitive:o})}),(0,r.jsx)("input",{type:"text",className:"block w-full max-w-md text-sm text-gray-700 mr-4 py-2 px-4 rounded-lg border-0 text-sm font-medium",placeholder:"spoiler",value:e.spoiler_text,onChange:o=>t({...e,spoiler_text:o.target.value})}),(0,r.jsx)("textarea",{className:"block w-full max-w-md text-sm text-gray-700 mr-4 py-2 px-4 rounded-lg border-0 text-sm font-medium",placeholder:"status",rows:4,value:c,onChange:e=>d(e.target.value)}),(0,r.jsxs)("div",{className:"flex w-full space-x-4",children:[(0,r.jsx)("input",{type:"number",className:"block w-full text-sm text-gray-700 py-2 px-4 rounded-lg border-0 font-medium",placeholder:"Moonchan BID",value:o.bid,onChange:e=>a({...o,bid:parseInt(e.target.value,10)||0})}),(0,r.jsx)("input",{type:"number",className:"block w-full text-sm text-gray-700 py-2 px-4 rounded-lg border-0 font-medium",placeholder:"Moonchan TID (for reply)",value:o.tid||"",onChange:e=>a({...o,tid:parseInt(e.target.value,10)||0})})]}),(0,r.jsx)("button",{className:(y?"bg-blue-500 hover:bg-blue-600":"bg-gray-400 cursor-not-allowed")+" w-full px-4 py-2 text-white rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",onClick:async function(){var e;w(!1);const t=0!==f.length?f:v,n=`https://moonchan.xyz/api/v2/?bid=${o.bid}&tid=${o.tid}`,l={"Content-Type":"application/json"},s=JSON.stringify({p:(null===(e=t[0])||void 0===e?void 0:e.url)||"",txt:c}),a=await fetch(n,{method:"POST",credentials:"include",headers:l,body:s});if(console.log(a),!a.ok)throw w(!0),new Error(`HTTP error! status: ${a.status}`);const r=await fetch(n).then((e=>e.json()));if(console.log(r),!r||Array.isArray(r)&&0===r.length)throw w(!0),new Error("No data returned from MoonChan API");const i=(Array.isArray(r)?r[0]:r).no;for(const c of t.slice(1)){const e=JSON.stringify({p:c.url||"",txt:""}),t=await fetch(`https://moonchan.xyz/api/v2/?bid=${o.bid}&tid=${i}`,{method:"POST",credentials:"include",headers:l,body:e});if(!t.ok)throw w(!0),new Error(`HTTP error! status: ${t.status}`)}},disabled:!y,children:"\u53d1\u5e03\u5230\u6708\u5c9b"}),(0,r.jsx)("button",{className:"w-full px-4 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600 focus:outline-none focus:ring-2 focus:ring-blue-500",onClick:()=>{const t={status:c,in_reply_to_id:g,media_ids:x,sensitive:e.sensitive,spoiler_text:e.spoiler_text,visibility:e.visibility,poll:null,language:"zh"};console.log(t),async function(e,t,o){const n=await fetch("https://proxy.moonchan.xyz/api/v1/statuses",{method:"POST",headers:{"X-Scheme":"https","X-Host":e,"X-Referer":`https://${e}/`,"Content-Type":"application/json",Authorization:`Bearer ${t}`},body:JSON.stringify(o)}).then((e=>e.json()));return console.log(n),n}(e.host,e.access_token,t).then((e=>{console.log("\u53d1\u5e03\u6210\u529f:",e),d(""),h(null),m([]),k(e.media_attachments||[])})).catch((e=>{console.error("\u53d1\u5e03\u5931\u8d25:",e)}))},children:"\u53d1\u5e03"}),(0,r.jsx)(p,{responseMedia:v})]})]})}const p=e=>{let{responseMedia:t,setImageArray:o}=e;return(0,r.jsx)("div",{className:"grid grid-cols-3 gap-4 max-w-4xl mx-auto",children:t.map((e=>(0,r.jsxs)("div",{className:"relative group bg-gray-100 rounded-lg overflow-hidden shadow-md hover:shadow-lg transition-all duration-300",style:{width:"200px",height:"200px",aspectRatio:"1/1"},children:[(0,r.jsx)(c,{data:e,onClick:e=>{!function(e){var t;null!==(t=navigator.clipboard)&&void 0!==t&&t.writeText?navigator.clipboard.writeText(e).then((()=>!0)).catch((()=>a(e))):a(e)}(e.url||"error")}}),o&&(0,r.jsx)("button",{className:"absolute top-2 right-2 bg-red-500 text-white \n                        rounded-full p-1.5 opacity-0 group-hover:opacity-100\n                        transition-opacity duration-200\n                        ",onClick:()=>{o&&o(t.filter((t=>t.id!==e.id)))},"aria-label":"\u5220\u9664\u56fe\u7247",children:(0,r.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",viewBox:"0 0 20 20",fill:"currentColor",children:(0,r.jsx)("path",{fillRule:"evenodd",d:"M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z",clipRule:"evenodd"})})})]},e.id)))})}}}]);
//# sourceMappingURL=58.0cff7d93.chunk.js.map